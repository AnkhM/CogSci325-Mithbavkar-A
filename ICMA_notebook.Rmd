---
title: "D2SC ICMAs"
output: html_notebook
author: "Ankit Mithbavkar"
date: "`r Sys.Date()`"
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

# ICMA 09/04/2025

```{r}
plot(cars)
```

```{r}
library(tidyverse)
library(dplyr)
library(palmerpenguins)
library(nycflights13)
library(ggplot2)
```


```{r}
ggplot(data = penguins,
       mapping = aes(x = flipper_length_mm, y = bill_length_mm)
) +
geom_point()
```


```{r}
view(penguins)
```

```{r}
PlantGrowth
```
```{r}
ggplot(data = PlantGrowth,
       mapping = aes(x = group, y = weight)
) + 
geom_point()
```

```{r}
glimpse(flights)
```
```{r}
flights |>
  filter(month == 1 & day == 1)

flights_houston <- flights |>
  filter(dest %in% c("IAH", "HOU"))
```

```{r}
flights |>
  arrange(year, month, desc(day), dep_time)
```
```{r}
flights |>
  distinct(origin, dest)
```
```{r}
flights |>
  filter(arr_delay > 120 & dep_delay <= 0) |>
  ggplot(aes(x = arr_delay, y = dep_delay)) +
  geom_point()
```
```{r}
flights |>
  mutate(speed = distance / air_time * 60,
         .after = distance) |>
  head()
```
```{r}
flights |>
  rename(dep_airport = origin,
         arr_airport = dest)
  select(year, month, day, contains("dep"))
  head()
  
flights |>
  select(!year:day)
  head()
```
```{r}
flights |>
  group_by(month) |>
  count()

flights |>
  group_by(month) |>
  summarize(avg_delay = mean(dep_delay))
```
```{r}
flights |>
  group_by(month) |>
  summarize(avg_arr_delay = mean(arr_delay, na.rm = TRUE),
          sd_arr_delay = sd(arr_delay, na.rm = TRUE),
          number_delayed = sum(arr_delay > 0, na.rm = TRUE),
          total = n(),
          percentage = number_delayed/total * 100
  ) |>
  ggplot(mapping = aes(x = month,
                       y = percentage))
```

## ICMA 9/23/2025

* Variables can't start with a number or include spaces or symbols
* Style we'll use is snake_case

```{r}
# backticks make this work
`1number` <- 12
print(`1number`)
```
```{r style-example, echo=TRUE}
library(nycflights13)
summary <- flights |>
  group_by(tailnum) |>
    summarize(avg_arr_delay = mean(arr_delay, na.rm=TRUE), num_flights = n())
summary
```
```{r}
#| label: style-example
#| echo: TRUE

library(nycflights13)
summary <- flights |>
  group_by(tailnum) |>
    summarize(avg_arr_delay = mean(arr_delay, na.rm=TRUE), num_flights = n())
summary
```

## ICMA 9/25/2025
```{r}
billboard_long <- billboard |>
  pivot_longer(cols = wk1:wk76,
               names_to = "week",
               values_to = "rank")
```

```{r}
billboard |>
  filter(artist == "2 Pac") |>
  select(wk10)
```
## ICMA 09/30/2025

* Simpson's Paradox: trend in overall data differs from trends in individual groups

```{r}
flights |>
  mutate(gain = arr_delay - dep_delay) |>
  filter(!is.na(gain)) |>
  group_by(carrier) |>
  summarize(
    avg_gain = mean(gain),
    total_flights = n()
  ) |>
  arrange(desc(avg_gain)) |>
  select(carrier, avg_gain, total_flights)
```
```{r}
getwd()
class_data <- read_csv("Week5-1_ClassData.csv", guess_max=2)
class_data
```
```{r}
problems(class_data)
```

```{r}
read_csv("Week5-1_ClassData.csv",
         col_types = list(bonusPayment = col_number()),
         na = c("N/A", ".")) |>
  rename(bonus_payment = bonusPayment)
```

# ICMA 10/07/2025

* Layers
  - Data: the dataframe you're plotting from
  - Aesthetic: specific things in the dataframe to be mapped to aspects of the data visualization: x-values, y-values, size-variation, color-categories, etc.
  - geom: a geometry representing data (line, points,etc.)
  - statistics: transformations to be plotted (means, medians, etc.)
  - facets: splitting the dataset based on some variable or category and providing a separate plot for each split
  - coordinates: numeric system to determine position of geometry
  - themes: default themes for axes, lines, grids, etc.

```{r}
mpg |>
  ggplot(aes(y = hwy, x = displ, color=manufacturer)) +
  geom_point(shape = 15, alpha = 0.5)
```
```{r}
mpg |>
  ggplot(aes(y = hwy, x = displ, shape=manufacturer)) +
  geom_point(color = "royalblue")
```

```{r}
mpg |>
  ggplot(aes(y=hwy, x=displ)) +
  geom_point() + 
  geom_smooth()
```

```{r}
mpg |>
  ggplot(aes(y=hwy, x=displ, color=drv)) + 
  geom_point() + 
  geom_smooth()

mpg |>
  ggplot(aes(y=hwy, x=displ)) + 
  geom_point(aes(color=drv)) + 
  geom_smooth()
```
```{r}
mpg |>
  ggplot(aes(x = class, fill = class)) +
  geom_bar()
```

## ICMA 10/14/2025

```{r}
ggplot(mpg, aes(x=displ, y=hwy)) +
  geom_point(aes(color = class)) + 
  geom_smooth(se=FALSE) +
  labs(
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    color = "Car type",
    title="Fuel efficiency generally decreases with engine size",
    subtitle="Two seaters (sports cars) are an exception because of their light weight",
    caption="Data from fueleconomy.gov"
  )

```
```{r}
ggplot(mpg, aes(x=displ, y=hwy)) +
  geom_text(aes(color = class, label="Car"))
```
```{r}
librar(ggrepel)

label_info <- mpg |>
  group_by(drv) |>
  arrange(desc(displ)) |>
  slice_head(n=1) |>
  mutate(
    drive_type = case_when(
      drv == "f" ~ "front=wheel drive",
      drv == "r" ~ "rear-wheel drive",
      drv == "4" ~ "4-wheel drive"
    )
  ) |>
  select(displ, hwy, drv, drive_type)

ggplot(mpg, aes(x=displ, y=hwy, color = drv)) +
  geom_point(alpha = 0.3) +
  geom_smooth(se = FALSE) +
  geom_text(
    data = label_info,
    aes(x = displ, y = hwy, label = drive_type),
    fontface = "bold", size = 5,
    hjust = "right", vjust="bottom"
  ) +
  theme(legend.position = "none")
```
```{r}
ggplot(mpg, aes(x=displ, y=hwy, color)) +
  geom_point() +
  annotate(
    geom = "label", x = 3.5, y = 38,
    label = str_wrap("Larger engine sizes tend to have lower fuel economy", width = 30),
    hjust = "left", color = "red"
  ) + 
  annotate(
    geom = "segment",
    x = 3, y = 35
  )
```
```{r}
ggplot(mpg, aes(x=displ, y=hwy, color=drv)) +
  geom_point() +
  geom_segment(aes(xend= 4, yend = 25)) +
  theme(legend.position = "top") +
  guides(color = guide_legend(nrow=3))
```
```{r}
ggplot(mpg, aes(X=displ, y=hwy)) +
  geom_point(aes(color=drv)) +
  geom_smooth() +
  cor_cardinates(xlim = 4, ylim=5)
```

## ICMA 10/21/2025

```{r}
my_values <- c(1,3,5,NA,8,10)
mean(my_values)
```

```{r}
my_values <- c(1,3,5,NA,8,10)
mean(my_values, na.rm=TRUE)
```
```{r}
is.na(my_values)
```
```{r}
flights |> filter(is.na(dep_time))
```

```{r}
flights |> filter(month == 11 | month == 12)
```

```{r}
flights |>
  filter(month %in% c(11,12))
```
```{r}
flights |>
  group_by(year, month, day) |>
  summarize(
    all_delayed = all(dep_delay <= 60, na.rm = TRUE),
    any_long_delay = any(arr_delay >= 300, na.rm = TRUE),
    .groups = "drop"
  )
```

```{r}
flights |>
  group_by(year, month, day) |>
  summarize(
    proportion_delayed = mean(dep_delay <= 60, na.rm=TRUE), # mean() is sum() / length()
    count_long_delay = sum(arr_delay <= 300, na.rm=TRUE),
    .groups = "drop"
  )
```

```{r}
x <- c(-3:3, NA)
if_else(x > 0, "+ve", "-ve", "???")
```
```{r}
case_when(
  x == 0 ~ "0",
  x < 0 ~ "-ve",
  x > 0 ~ "+ve",
  .default = "???"
)
```
```{r}
flights |>
  group_by(dest) |>
  summarize(
    n = n(),
  ) |>
  head()
```
```{r}
flights |>
  group_by(dest) |>
  summarize(carriers = n_distinct(carrier)) |>
  arrange(desc(carriers))
```

